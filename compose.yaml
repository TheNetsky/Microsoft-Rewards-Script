services:
  microsoft-rewards-script:
    build: .
    container_name: microsoft-rewards-script
    restart: unless-stopped

    # Volume mounts: Specify a location where you want to save the files on your local machine.
    volumes:
      - ./src/accounts.json:/usr/src/microsoft-rewards-script/dist/accounts.json:ro
      - ./src/config.json:/usr/src/microsoft-rewards-script/dist/config.json:ro
      - ./sessions:/usr/src/microsoft-rewards-script/dist/browser/sessions # Optional, saves your login session

    environment:
      TZ: "America/Toronto" # Set your timezone for proper scheduling
      NODE_ENV: "production"
      #SCHEDULER_DAILY_JITTER_MINUTES_MIN: "2"
      #SCHEDULER_DAILY_JITTER_MINUTES_MAX: "10"
      # Watchdog timeout per pass (minutes, default 180)
      #SCHEDULER_PASS_TIMEOUT_MINUTES: "180"
      # Run pass in child process (default true). Set to "false" to disable for debugging.
      #SCHEDULER_FORK_PER_PASS: "true"

    # Optional resource limits for the container
    mem_limit: 4g
    cpus: 2

    # Security hardening
    security_opt:
      - no-new-privileges:true

    # Use the built-in scheduler by default
    command: ["npm", "run", "start:schedule"]